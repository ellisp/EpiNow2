<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Estimate Infections, the Time-Varying Reproduction Number and the Rate of Growth — estimate_infections • EpiNow2</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Estimate Infections, the Time-Varying Reproduction Number and the Rate of Growth — estimate_infections" />
<meta property="og:description" content="This function uses a non-parametric approach to reconstruct cases by date of infection from reported
cases. It can optionally then estimate the time-varying reproduction number and the rate of growth." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EpiNow2</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/epiforecasts/EpiNow2">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate Infections, the Time-Varying Reproduction Number and the Rate of Growth</h1>
    
    <div class="hidden name"><code>estimate_infections.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function uses a non-parametric approach to reconstruct cases by date of infection from reported
cases. It can optionally then estimate the time-varying reproduction number and the rate of growth.</p>
    </div>

    <pre class="usage"><span class='fu'>estimate_infections</span>(
  <span class='kw'>reported_cases</span>,
  family = <span class='st'>"negbin"</span>,
  <span class='kw'>generation_time</span>,
  <span class='kw'>delays</span>,
  gp = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(basis_prop = <span class='fl'>0.3</span>, boundary_scale = <span class='fl'>2</span>),
  rt_prior = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(mean = <span class='fl'>1</span>, sd = <span class='fl'>1</span>),
  prior_smoothing_window = <span class='fl'>7</span>,
  horizon = <span class='fl'>7</span>,
  <span class='kw'>model</span>,
  cores = <span class='fl'>1</span>,
  chains = <span class='fl'>4</span>,
  samples = <span class='fl'>1000</span>,
  warmup = <span class='fl'>200</span>,
  estimate_rt = <span class='fl'>TRUE</span>,
  estimate_week_eff = <span class='fl'>TRUE</span>,
  estimate_breakpoints = <span class='fl'>FALSE</span>,
  burn_in = <span class='fl'>0</span>,
  stationary = <span class='fl'>FALSE</span>,
  fixed = <span class='fl'>FALSE</span>,
  adapt_delta = <span class='fl'>0.99</span>,
  max_treedepth = <span class='fl'>15</span>,
  return_fit = <span class='fl'>FALSE</span>,
  verbose = <span class='fl'>TRUE</span>,
  debug = <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>reported_cases</th>
      <td><p>A data frame of confirmed cases (confirm) by date (date). confirm must be integer and date must be
in date format.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>A character string indicating the reporting model to use. Defaults to negative
binomial ("negbin") with poisson ("poisson") also supported.</p></td>
    </tr>
    <tr>
      <th>generation_time</th>
      <td><p>A list containing the mean, standard deviation of the mean (mean_sd),
standard deviation (sd), standard deviation of the standard deviation and the maximum allowed value for the
generation time (assuming a gamma distribution).</p></td>
    </tr>
    <tr>
      <th>delays</th>
      <td><p>A list of delays (i.e incubation period/reporting delay) between infection and report.
Each list entry must also be a list containing the mean, standard deviation of the mean (mean_sd),
standard deviation (sd), standard deviation of the standard deviation and the maximum allowed value for the
that delay (assuming a lognormal distribution with all parameters excepting the max allowed value
on the log scale).</p></td>
    </tr>
    <tr>
      <th>gp</th>
      <td><p>List controlling the Gaussian process approximation. Must contain
the <code>basis_prop</code> (number of basis functions based on scaling the time points) which defaults to 0.3 and must be
between 0 and 1 (increasing this increases the accuracy of the approximation and the cost of additional compute.
Must also contain the <code>boundary_scale</code> (multiplied by half the range of the input time series). Increasing this
increases the accuracy of the approximation at the cost of additional compute.
See here: https://arxiv.org/abs/2004.11408 for more information on setting these parameters.
Can optionally also contain the  <code>lengthscale_mean</code> and <code>lengthscale_sd</code>. If these are specified this will override
the defaults of 0 and 2 (normal distributed truncated at zero).</p></td>
    </tr>
    <tr>
      <th>rt_prior</th>
      <td><p>A list contain the mean and standard deviation (sd) of the gamma distributed prior for
Rt. By default this is assumed to be mean 1 with a standard deviation of 1.</p></td>
    </tr>
    <tr>
      <th>prior_smoothing_window</th>
      <td><p>Numeric defaults to 7. The number of days over which to take a rolling average
for the prior based on reported cases.</p></td>
    </tr>
    <tr>
      <th>horizon</th>
      <td><p>Numeric, defaults to 7. Number of days into the future to forecast.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>A compiled stan model. By default uses the internal package model.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Numeric, defaults to 2. The number of cores to use when fitting the stan model.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>Numeric, defaults to 2. The number of MCMC chains to use.</p></td>
    </tr>
    <tr>
      <th>samples</th>
      <td><p>Numeric, defaults to 1000. Number of samples post warmup.</p></td>
    </tr>
    <tr>
      <th>warmup</th>
      <td><p>Numeric, defaults to 200. Number of iteration of warmup to use.</p></td>
    </tr>
    <tr>
      <th>estimate_rt</th>
      <td><p>Logical, defaults TRUE. Should Rt be estimated when imputing infections.</p></td>
    </tr>
    <tr>
      <th>estimate_week_eff</th>
      <td><p>Logical, defaults TRUE. Should weekly reporting effects be estimated.</p></td>
    </tr>
    <tr>
      <th>estimate_breakpoints</th>
      <td><p>Logical, defaults to FALSE. Should breakpoints in Rt be estimated. If true then <code>reported_cases</code>
must contain a <code>breakpoint</code> variable that is 1 on the dates with breakpoints and otherwise 0. Breakpoints are fit jointly with
a global non-parametric effect and so represent a conservative estimate of breakpoint changes.</p></td>
    </tr>
    <tr>
      <th>burn_in</th>
      <td><p>Numeric, defaults to 0. The number of initial estimates to discard. This argument may be used to reduce
spurious findings when running <code>estimate_infections</code> on a partial timeseries (as the earliest estimates will not be informed by
all cases that occurred only those supplied to <code>estimate_infections</code>). The combined delays used will inform the appropriate length
of this burn in but 7 days is likely a sensible starting point.</p></td>
    </tr>
    <tr>
      <th>stationary</th>
      <td><p>Logical, defaults to FALSE. Should Rt be estimated with a global mean. When estimating Rt
this should substantially improve run times but will revert to the global average for real time and forecasted estimates.
This setting is most appropriate when estimating historic Rt or when combined with breakpoints.</p></td>
    </tr>
    <tr>
      <th>fixed</th>
      <td><p>Logical, defaults to FALSE. If TRUE then a Gaussian process is not used and Rt is assumed to be constant over time
(apart from any manually included breakpoints). If <code>estimate_rt</code> is FALSE then this reduces the backcalculation to a simple mean shift.
This option can be used to produce a null model estimate, to produce a single Rt estimate for a short timeseries or as part of a wider
analysis on the impact of interventions.</p></td>
    </tr>
    <tr>
      <th>adapt_delta</th>
      <td><p>Numeric, defaults to 0.99. See ?rstan::sampling.</p></td>
    </tr>
    <tr>
      <th>max_treedepth</th>
      <td><p>Numeric, defaults to 15. See ?rstan::sampling.</p></td>
    </tr>
    <tr>
      <th>return_fit</th>
      <td><p>Logical, defaults to FALSE. Should the fitted stan model be returned.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical, defaults to <code>TRUE</code>. Should verbose progress messages be printed.</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>Logical, defaults to <code>FALSE</code>. Enables debug model in which additional diagnostics are available</p></td>
    </tr>
    </table>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># Get example case counts</span>
<span class='kw'>reported_cases</span> <span class='op'>&lt;-</span> <span class='kw'>EpiNow2</span>::<span class='kw'><a href='example_confirmed.html'>example_confirmed</a></span>[<span class='fl'>1</span><span class='op'>:</span><span class='fl'>50</span>]

<span class='co'># Add a dummy breakpoint (used only when optionally estimating breakpoints)</span>
<span class='kw'>reported_cases</span> <span class='op'>&lt;-</span> <span class='kw'>reported_cases</span>[, <span class='kw'>breakpoint</span> <span class='op'>:=</span> <span class='kw'>data.table</span>::<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/fifelse.html'>fifelse</a></span>(<span class='kw'>date</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span>(<span class='st'>"2020-03-16"</span>),
                                                                     <span class='fl'>1</span>, <span class='fl'>0</span>)]
<span class='co'># Set up example generation time</span>
<span class='kw'>generation_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(mean = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_generation_times.html'>covid_generation_times</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>mean</span>,
                        mean_sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_generation_times.html'>covid_generation_times</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>mean_sd</span>,
                        sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_generation_times.html'>covid_generation_times</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>sd</span>,
                        sd_sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_generation_times.html'>covid_generation_times</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>sd_sd</span>,
                        max = <span class='fl'>30</span>)
<span class='co'># Set delays between infection and case report </span>
<span class='co'># (any number of delays can be specifed here)             </span>
<span class='kw'>incubation_period</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(mean = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_incubation_period.html'>covid_incubation_period</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>mean</span>,
                          mean_sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_incubation_period.html'>covid_incubation_period</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>mean_sd</span>,
                          sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_incubation_period.html'>covid_incubation_period</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>sd</span>,
                          sd_sd = <span class='kw'>EpiNow2</span>::<span class='kw'><a href='covid_incubation_period.html'>covid_incubation_period</a></span>[<span class='fl'>1</span>, ]<span class='op'>$</span><span class='kw'>sd_sd</span>,
                          max = <span class='fl'>30</span>)
                   
<span class='kw'>reporting_delay</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(mean = <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>5</span>),
                        mean_sd = <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>2</span>),
                        sd = <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>2</span>),
                        sd_sd = <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='fl'>1.5</span>),
                        max = <span class='fl'>30</span>)
                        
<span class='co'># Run model with default settings</span>
<span class='kw'>def</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                           generation_time = <span class='kw'>generation_time</span>,
                           delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                           samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                           chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: There were 1 divergent transitions after warmup. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
#&gt; <span class='warning'>to find out why this is a problem and how to eliminate them.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='input'>

<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>def</span><span class='op'>$</span><span class='kw'>summarised</span>,
                      reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-1.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-2.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-3.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-4.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-5.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Run the model with default setting on a later snapshot of </span>
<span class='co'># data (use burn_in here to remove the first week of</span>
<span class='co'># estimates that may be impacted by this most).</span>
<span class='kw'>snapshot_cases</span> <span class='op'>&lt;-</span> <span class='kw'>EpiNow2</span>::<span class='kw'><a href='example_confirmed.html'>example_confirmed</a></span>[<span class='fl'>80</span><span class='op'>:</span><span class='fl'>130</span>]
<span class='kw'>snapshot</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>snapshot_cases</span>, family = <span class='st'>"negbin"</span>,
                                generation_time = <span class='kw'>generation_time</span>,
                                delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                                samples = <span class='fl'>1000</span>, warmup = <span class='fl'>400</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>), 
                                chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>,
                                burn_in = <span class='fl'>7</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: There were 1 divergent transitions after warmup. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
#&gt; <span class='warning'>to find out why this is a problem and how to eliminate them.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#tail-ess</span></div><div class='input'>

<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>snapshot</span><span class='op'>$</span><span class='kw'>summarised</span>,
                      reported = <span class='kw'>snapshot_cases</span>)     </div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-6.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-7.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-8.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-9.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-10.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'>## Run model with stationary Rt assumption (likely to provide biased real-time estimates)</span>
<span class='kw'>stat</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                            generation_time = <span class='kw'>generation_time</span>,
                            delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                            samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                            chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, stationary = <span class='fl'>TRUE</span>,
                            verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)


<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>stat</span><span class='op'>$</span><span class='kw'>summarised</span>,
             reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-11.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-12.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-13.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-14.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-15.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>       
<span class='co'># Run model with fixed Rt assumption </span>
<span class='kw'>fixed</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                            generation_time = <span class='kw'>generation_time</span>,
                            delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                            samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                            chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, fixed = <span class='fl'>TRUE</span>, 
                            verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)


<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>fixed</span><span class='op'>$</span><span class='kw'>summarised</span>,
             reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-16.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-17.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-18.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-19.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-20.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Run model with breakpoints                                                                      </span>
<span class='kw'>bkp</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                           generation_time = <span class='kw'>generation_time</span>,
                           delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                           samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>), 
                           chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, estimate_breakpoints = <span class='fl'>TRUE</span>, 
                           verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='input'>

<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>bkp</span><span class='op'>$</span><span class='kw'>summarised</span>,
             reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-21.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-22.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-23.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-24.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-25.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>             
<span class='co'># Run model with breakpoints but with constrained non-linear change over time </span>
<span class='co'># This formulation may increase the apparent effect of the breakpoint but needs to be tested using</span>
<span class='co'># model fit criteria (i.e LFO).                                                                    </span>
<span class='kw'>cbkp</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                            generation_time = <span class='kw'>generation_time</span>,
                            gp = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(basis_prop = <span class='fl'>0.3</span>, boundary_scale = <span class='fl'>2</span>, 
                                     lengthscale_mean = <span class='fl'>20</span>, lengthscale_sd = <span class='fl'>1</span>),
                            delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                            samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                            chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>TRUE</span>, estimate_breakpoints = <span class='fl'>TRUE</span>,
                            verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: There were 6 divergent transitions after warmup. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span>
#&gt; <span class='warning'>to find out why this is a problem and how to eliminate them.</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Examine the pairs() plot to diagnose sampling problems</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='input'>

<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>cbkp</span><span class='op'>$</span><span class='kw'>summarised</span>,
             reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-26.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-27.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-28.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-29.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-30.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>             
<span class='co'># Pull out breakpoint summary</span>
<span class='kw'>cbkp</span><span class='op'>$</span><span class='kw'>summarised</span>[<span class='kw'>variable</span> <span class='op'>==</span> <span class='st'>"breakpoints"</span>]</div><div class='output co'>#&gt;    date    variable strat type    bottom      top     lower    upper    median
#&gt; 1: &lt;NA&gt; breakpoints     1 &lt;NA&gt; 0.7866159 1.079499 0.8810399 1.009634 0.9397755
#&gt;         mean         sd
#&gt; 1: 0.9445512 0.09037497</div><div class='input'>
<span class='co'># Run model with breakpoints but otherwise static Rt</span>
<span class='co'># This formulation may increase the apparent effect of the breakpoint but needs to be tested using</span>
<span class='co'># model fit criteria (i.e LFO).                                                                    </span>
<span class='kw'>fbkp</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                            generation_time = <span class='kw'>generation_time</span>,
                            delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                            samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                            chains = <span class='fl'>4</span>, estimate_breakpoints = <span class='fl'>TRUE</span>, fixed = <span class='fl'>TRUE</span>, 
                            verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#tail-ess</span></div><div class='input'>

<span class='co'># Plot output</span>
<span class='fu'><a href='report_plots.html'>report_plots</a></span>(summarised_estimates = <span class='kw'>fbkp</span><span class='op'>$</span><span class='kw'>summarised</span>,
             reported = <span class='kw'>reported_cases</span>)</div><div class='output co'>#&gt; $infections</div><div class='img'><img src='estimate_infections-31.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reports</div><div class='img'><img src='estimate_infections-32.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $reff</div><div class='img'><img src='estimate_infections-33.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $growth_rate</div><div class='img'><img src='estimate_infections-34.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; 
#&gt; $summary</div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Removed 1 rows containing missing values (geom_col).</span></div><div class='img'><img src='estimate_infections-35.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; </div><div class='input'>             
<span class='co'># Pull out breakpoint summary</span>
<span class='kw'>fbkp</span><span class='op'>$</span><span class='kw'>summarised</span>[<span class='kw'>variable</span> <span class='op'>==</span> <span class='st'>"breakpoints"</span>]</div><div class='output co'>#&gt;    date    variable strat type    bottom       top     lower     upper   median
#&gt; 1: &lt;NA&gt; breakpoints     1 &lt;NA&gt; 0.5320847 0.6256983 0.5591234 0.5984567 0.582272
#&gt;         mean         sd
#&gt; 1: 0.5837727 0.02898435</div><div class='input'>
<span class='co'># Run model without Rt estimation (just backcalculation)</span>
<span class='kw'>backcalc</span> <span class='op'>&lt;-</span> <span class='fu'>estimate_infections</span>(<span class='kw'>reported_cases</span>, family = <span class='st'>"negbin"</span>,
                                generation_time = <span class='kw'>generation_time</span>,
                                delays = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>incubation_period</span>, <span class='kw'>reporting_delay</span>),
                                samples = <span class='fl'>1000</span>, warmup = <span class='fl'>200</span>, cores = <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span>(), <span class='fl'>4</span>, <span class='fl'>1</span>),
                                chains = <span class='fl'>4</span>, estimate_rt = <span class='fl'>FALSE</span>, verbose = <span class='fl'>FALSE</span>, return_fit = <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='warning'>Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#bulk-ess</span></div><div class='output co'>#&gt; <span class='warning'>Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.</span>
#&gt; <span class='warning'>Running the chains for more iterations may help. See</span>
#&gt; <span class='warning'>http://mc-stan.org/misc/warnings.html#tail-ess</span></div><div class='input'>
 
<span class='co'># plot just infections as report_plots does not support the backcalculation only model</span>
<span class='fu'><a href='plot_estimates.html'>plot_estimates</a></span>(estimate = <span class='kw'>backcalc</span><span class='op'>$</span><span class='kw'>summarised</span>[<span class='kw'>variable</span> <span class='op'>==</span> <span class='st'>"infections"</span>],
               reported = <span class='kw'>reported_cases</span>, ylab = <span class='st'>"Cases"</span>)</div><div class='img'><img src='estimate_infections-36.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># }                                </span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sam Abbott, Joel Hellewell, Robin Thompson, Katelyn Gostic, Katharine Sherratt, Sophie Meakin, James Munday, Nikos Bosse, Paul Mee, EpiForecasts, Sebastian Funk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


